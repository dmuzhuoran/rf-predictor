
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Cluster Prediction</title>
  <style>
    body { font-family: Arial; padding: 20px; max-width: 800px; margin: auto; }
    h1 { color: #333; }
    label { display: block; margin: 10px 0; }
    input { width: 100%; padding: 6px; margin-top: 2px; }
    button { margin-top: 15px; padding: 10px 20px; font-size: 16px; }
    #result { margin-top: 20px; font-weight: bold; font-size: 18px; color: green; }
  </style>
</head>
<body>
  <h1>Cluster Prediction</h1>
  <form id="predictForm">
    <label>Age: <input type="number" name="Age" step="any" required></label>
    <label>Female: <input type="number" name="Female" min="0" max="1" step="1" required></label>
    <label>Fever: <input type="number" name="Fever" min="0" max="1" step="1" required></label>
    <label>Weight.loss: <input type="number" name="Weight.loss" step="any" required></label>
    <label>Proximal.pain: <input type="number" name="Proximal.pain" min="0" max="1" step="1" required></label>
    <label>Peripheral.arthritis: <input type="number" name="Peripheral.arthritis" min="0" max="1" step="1" required></label>
    <label>Headache: <input type="number" name="Headache" min="0" max="1" step="1" required></label>
    <label>Jaw.claudication: <input type="number" name="Jaw.claudication" min="0" max="1" step="1" required></label>
    <label>Visual.symptoms: <input type="number" name="Visual.symptoms" min="0" max="1" step="1" required></label>
    <label>ESR: <input type="number" name="ESR" step="any" required></label>
    <label>CRP: <input type="number" name="CRP" step="any" required></label>
    <label>WBC: <input type="number" name="WBC" step="any" required></label>
    <label>Hb: <input type="number" name="Hb" step="any" required></label>
    <label>PLT: <input type="number" name="PLT" step="any" required></label>
    <label>Neutrophils: <input type="number" name="Neutrophils" step="any" required></label>
    <label>Lymphocytes: <input type="number" name="Lymphocytes" step="any" required></label>
    <label>Hct: <input type="number" name="Hct" step="any" required></label>
    <label>RDW: <input type="number" name="RDW" step="any" required></label>
    <label>RF: <input type="number" name="RF" min="0" max="1" step="1" required></label>
    <label>CCP: <input type="number" name="CCP" min="0" max="1" step="1" required></label>
    <label>ANA: <input type="number" name="ANA" min="0" max="1" step="1" required></label>
    <label>ALT: <input type="number" name="ALT" step="any" required></label>
    <label>AST: <input type="number" name="AST" step="any" required></label>
    <label>GGT: <input type="number" name="GGT" step="any" required></label>
    <label>ALP: <input type="number" name="ALP" step="any" required></label>
    <label>Albumin: <input type="number" name="Albumin" step="any" required></label>
    <button type="submit">Predict</button>
  </form>

  <hr>
  <h2>Batch Prediction (CSV)</h2>
  <input type="file" id="csvFile" accept=".csv">
  <button onclick="handleCSVUpload()">Upload & Predict</button>
  <div id="csvResult"></div>

  <div id="result"></div>

  <script src="predict.js"></script>
  <script>
    const binary_vars = ["Female", "Fever", "Proximal.pain", "Peripheral.arthritis", "Headache", "Jaw.claudication", "Visual.symptoms", "RF", "CCP", "ANA"];
    const feature_names = ["Age", "Female", "Fever", "Weight.loss", "Proximal.pain", "Peripheral.arthritis", "Headache", "Jaw.claudication", "Visual.symptoms", "ESR", "CRP", "WBC", "Hb", "PLT", "Neutrophils", "Lymphocytes", "Hct", "RDW", "RF", "CCP", "ANA", "ALT", "AST", "GGT", "ALP", "Albumin"];

    document.addEventListener("DOMContentLoaded", () => {
      document.getElementById("predictForm").addEventListener("submit", function (e) {
        e.preventDefault();
        const inputData = {};
        let valid = true;

        feature_names.forEach(name => {
          const el = document.getElementsByName(name)[0];
          const val = el.value.trim();
          if (binary_vars.includes(name) && val !== "0" && val !== "1") {
            alert(name + " must be 0 or 1.");
            valid = false;
            return;
          }
          inputData[name] = val === "" ? null : parseFloat(val);
        });

        if (!valid) return;

        try {
          const prediction = predictSingle(inputData);
          document.getElementById("result").innerText = "Predicted Cluster: Cluster " + (parseInt(prediction) + 1);
        } catch (err) {
          document.getElementById("result").innerText = "❌ Prediction failed: " + err.message;
        }
      });
    });

    function handleCSVUpload() {
      const fileInput = document.getElementById('csvFile');
      const file = fileInput.files[0];
      if (!file) return alert("Please upload a CSV file.");

      const reader = new FileReader();
      reader.onload = function (e) {
        const lines = e.target.result.split("\n").filter(l => l.trim() !== "");
        const header = lines[0].split(',');
        const rows = lines.slice(1);

        const predictions = rows.map((row, index) => {
          const values = row.split(',');
          const data = {};
          feature_names.forEach((key, i) => {
            const val = values[i]?.trim();
            data[key] = val === "" ? null : parseFloat(val);
          });
          try {
            const pred = predictSingle(data);
            return `Row ${index + 1}: Cluster ${parseInt(pred) + 1}`;
          } catch (e) {
            return `Row ${index + 1}: Error - ${e.message}`;
          }
        });
        document.getElementById("csvResult").innerText = predictions.join("\n");
      };
      reader.readAsText(file);
    }
  </script>
</body>
</html>
